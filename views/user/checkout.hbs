

	<!-- Shoping Cart -->
	<form class="bg0 p-t-75 p-b-85" action="" method="post" id="checkout-form">
		<div class="container">
			<div class="row">
				
				<div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
					<div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
						<h4 class="mtext-109 cl2 p-b-30">
							Address
						</h4>

						

						<div class="flex-w flex-t bor12 p-t-15 p-b-30">
							<div class="size-208 w-full-ssm">
								<span class="stext-110 cl2">
									Shipping:
								</span>
							</div>

							<div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
								<p class="stext-111 cl6 p-t-2">
									There are no shipping methods available. Please double check your address, or contact us if you need any help.
								</p>
								
								<div class="p-t-15">
									<span class="stext-112 cl8">
										Calculate Shipping
									</span>
									{{#if userData.adressData}}

								
									<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
										<select class="js-select2" name="country" required>
											<option>{{userData.address.country}}</option>
											
										</select>
										<div class="dropDownSelect2"></div>
									</div>

									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="state" placeholder="State /  country" required value="{{userData.address.state}}">
										
									</div>
									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="district" placeholder="District / State /  country" required value="{{userData.address.district}}">

									</div>
									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="place" placeholder="Place / District / State /  country" required value="{{userData.address.place}}">
									</div>

									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="number" name="pincode" placeholder="Pincode / Zip" required value="{{userData.address.pincode}}">
									</div>
									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="number" name="mobile" placeholder="Mobile No" required value="{{userData.address.mobile}}">
									</div>
									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="userId" value="{{uservalue._id}}" hidden>
									</div>
									
									<div class="d-flex" >
										<input type="checkbox" name="savebox" id="savebox"><label for="savebox" class="ml-3 mt-2">Save Address</label>
									</div>

									{{/if}}

									{{#unless userData.adressData}}
									<div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
										<select class="js-select2" name="country" required>
											<option>Select a country...</option>
											<option>USA</option>
											<option>UK</option>
												<option>India</option>
										</select>
										<div class="dropDownSelect2"></div>
									</div>

									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="state" placeholder="State /  country" required>
									</div>
									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="district" placeholder="District / State /  country" required>
									</div>
									<div class="bor8 bg0 m-b-12">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="place" placeholder="Place / District / State /  country" required>
									</div>

									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="number" name="pincode" placeholder="Pincode / Zip" required>
									</div>
									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="number" name="mobile" placeholder="Mobile No" required>
									</div>
									<div class="bor8 bg0 m-b-22">
										<input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="userId" value="{{uservalue._id}}" hidden>
									</div>
										
									<div class="d-flex" >
										<input type="checkbox" name="savebox" id="savebox"><label for="savebox" class="ml-3 mt-2">Save Address</label>
									</div>

								
									{{/unless}}	

								
									
								</div>
								
							</div>
							<div class="d-flex flex-sb-m  p-t-18 p-b-15 p-lr-40 p-lr-15-sm">

										
										<input class=" cl2 plh4  bor13  m-r-10 m-tb-5" type="text" id="coupon" style=" margin-left: 0; width: 100px; height: 40px ;text-align: center;"
											 placeholder="Coupon Code" name="couponCode">
											



										<div class="flex-c-m stext-101 cl2 size-118 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-5"
												onclick="applyCoupon()">
												Apply coupon
										</div>
										
								</div>
								<div>
									<span id="couponValid"></span>
								</div>
							
						</div>
					</div>
				</div>
				<div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50 bor10">
					<br>
					 <h4 class="mtext-109 cl2 p-b-30">
							Order Summary
						</h4>
                  <div class="aa-order-summary-area">
                    <table class="table table-responsive">
                      <thead>
                        <tr>
                          <th class="stext-110 cl2">Product</th>
                          <th class="stext-110 cl2">Price</th>
                        </tr>
                      </thead>
                      <tbody>
					{{#each products}}
                        <tr>
                          <td>{{this.product.Pro-name}}<strong> x  {{this.quantity}}</strong></td>
                          <td>Rs. {{this.product.price}}</td>
                        </tr>
						{{/each}}
                        
                      </tbody>
                      <tfoot>
                        <tr>
                          <th class="stext-110 cl2">Sub Total</th>
                          <td><div class="size-209">
							<input type="text" id="subtotal" value=" {{total}}" readonly>
						</div></td>
                        </tr>
                         <th class="stext-110 cl2">
							
								
									<span class="stext-110 cl2" id="discnt">
									Discount:
									</span>
								

								
									<td>
									<div class="size-209">
										<span id="discont">- <span id="discount">0</span></span>
									
									</div></td>
								
								
						</th>
                         <tr>
                          <th class="stext-110 cl2 ">Total</th>
						<td > <div class="size-209">
						<span id="totalAmount">{{total}}</span>
						</div></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
										<div class="size-208 w-full-ssm mb-3">
											<span class="stext-110 cl2">
												Payment Method:
											</span>
										</div>
										<div class="aa-payment-method d-flex">                    
											<label for="" class="radio-inline d-flex">
												<input type="radio" name="payment-method" class="mr-2" value="COD" checked> COD
											</label>
											<label for="" class="radio-inline ml-5 d-flex">
												<input type="radio" name="payment-method"class="mr-2" value="ONLINE">Online Payment
											</label>
										</div>
									
									<div class="flex-w flex-t p-t-27 p-b-33">
										<div class="size-208">
											<span class="mtext-101 cl2">
												Total:
											</span>
										</div>

										<div class="size-209">
										<span id="totalAmount">{{total}}</span>
										</div>
									</div>
								

									<input type="submit" class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer" value="Proceed to Checkout">
					</div>
						
		</div>
	</form>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
   <script>
    $("#checkout-form").submit((e)=>{
      e.preventDefault()
      $.ajax({
        url:'/checkout',
        method:'post',
        data:$('#checkout-form').serialize(),
        success:(response)=>{
          alert:(response)
		  
		  if(response.codSuccess){
			location.href='/orderPlaced'
		  }
		  else{
			razorpayPayment(response)
		  }
        }
      })
    })
	function razorpayPayment (order){
			var options = {
				"key": "rzp_test_DmXrXrP2Rr9b7N", // Enter the Key ID generated from the Dashboard
				"amount": "order.amount", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
				"currency": "INR",
				"name": "Coza Store",
				"description": "Test Transaction",
				"image": "https://example.com/your_logo",
				"order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
				"handler": function (response){
					

					verifyPayment(response,order);
				},
				"prefill": {
					"name": "Gaurav Kumar",
					"email": "gaurav.kumar@example.com",
					"contact": "9999999999"
				},
				"notes": {
					"address": "Razorpay Corporate Office"
				},
				"theme": {
					"color": "#3399cc"
				}
			};
			var rzp1 = new Razorpay(options);
			rzp1.open();
	}
	function verifyPayment(payment,order){
		$.ajax({
			url:'/verifyPayment',
			data:{
				payment,
				order
			},
			method:'post',
			success:(response)=>{
				if(response.status){
					
					location.href='/orderPlaced'
				}else{
					alert("payment failed")
				}
			}
		})
	}
  </script>

		 

	<script>
    function applyCoupon() {
		console.log('coupon clicked')
      let couponcode = $('#coupon').val();
      console.log(couponcode);
      let subtotal = $('#subtotal').val();
      console.log(subtotal);
      $.ajax({
        url: '/apply-coupon/' + couponcode,
        method: 'get',
        success: (response) => {
          if (response.status) {
            $('#couponValid').show()
            $('#couponValid').html('<i class="text-success fa-regular fa-circle-check"></i>  Valid Code')
            setTimeout(() => {
              $('#couponInput').prop('readonly', true)
              console.log('hi');
            }, 1000)
           console.log(response.discount)
           console.log(response.totalAmount)
            $('#discount').html(response.discount)
            $('#discount').addClass('text-success')
            $('#discnt').addClass('text-success')
            $('#discont').addClass('text-success')
            $('#totalPrice').html(response.totalAmount)
          } else {
            $('#couponValid').show()
            $('#couponValid').html('<i class="fa-solid text-danger fa-xmark"></i> Invalid code/check crietria')
            $("#discount").html(0)
            setTimeout(() => {
              $('#couponValid').hide()
            }, 3000)
          }
        }
      })
    }
  </script>